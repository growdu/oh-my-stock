# 库表设计

## 股票基础信息表 (stock_basic_info)

```sql
CREATE TABLE stock_basic_info (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL UNIQUE,        -- 股票代码(如:600000)
    name VARCHAR(50) NOT NULL,                -- 股票名称
    full_name VARCHAR(100),                   -- 公司全称
    industry VARCHAR(50),                     -- 所属行业
    area VARCHAR(50),                         -- 地区
    market VARCHAR(20),                       -- 市场类型(主板/创业板/科创板等)
    listing_date DATE,                        -- 上市日期
    outstanding_shares DECIMAL(20,4),         -- 流通股本(万股)
    total_shares DECIMAL(20,4),               -- 总股本(万股)
    is_hs BOOLEAN,                            -- 是否沪深港通标的
    status VARCHAR(20),                       -- 上市状态
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_stock_basic_symbol ON stock_basic_info(symbol);
CREATE INDEX idx_stock_basic_industry ON stock_basic_info(industry);
```

## 股票日线交易数据表 (stock_daily_data)

```sql
CREATE TABLE stock_daily_data (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL,              -- 股票代码
    trade_date DATE NOT NULL,                 -- 交易日期
    open DECIMAL(12,4),                      -- 开盘价
    high DECIMAL(12,4),                      -- 最高价
    low DECIMAL(12,4),                       -- 最低价
    close DECIMAL(12,4),                     -- 收盘价
    adj_close DECIMAL(12,4),                 -- 后复权收盘价
    volume BIGINT,                           -- 成交量(股)
    turnover DECIMAL(20,4),                  -- 成交额(元)
    change_percent DECIMAL(10,4),            -- 涨跌幅(%)
    change_amount DECIMAL(10,4),             -- 涨跌额
    turnover_rate DECIMAL(10,4),             -- 换手率(%)
    pe_ttm DECIMAL(10,4),                    -- 市盈率(TTM)
    pb DECIMAL(10,4),                        -- 市净率
    amplitude DECIMAL(10,4),                 -- 振幅(%)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT uk_stock_daily UNIQUE (symbol, trade_date)
);

CREATE INDEX idx_stock_daily_symbol ON stock_daily_data(symbol);
CREATE INDEX idx_stock_daily_date ON stock_daily_data(trade_date);
```

## 股票财务数据表 (stock_financial_data)

```sql
CREATE TABLE stock_financial_data (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL,              -- 股票代码
    report_date DATE NOT NULL,                -- 报告期
    report_type VARCHAR(20),                  -- 报告类型(年报/季报等)
    eps DECIMAL(10,4),                       -- 每股收益
    eps_diluted DECIMAL(10,4),               -- 稀释每股收益
    total_revenue DECIMAL(20,4),             -- 营业总收入(元)
    operating_profit DECIMAL(20,4),          -- 营业利润(元)
    net_profit DECIMAL(20,4),                -- 净利润(元)
    total_assets DECIMAL(20,4),              -- 总资产(元)
    total_liabilities DECIMAL(20,4),         -- 总负债(元)
    equity DECIMAL(20,4),                    -- 股东权益(元)
    roe DECIMAL(10,4),                       -- 净资产收益率(%)
    gross_margin DECIMAL(10,4),              -- 毛利率(%)
    operating_cash_flow DECIMAL(20,4),       -- 经营活动现金流(元)
    investing_cash_flow DECIMAL(20,4),       -- 投资活动现金流(元)
    financing_cash_flow DECIMAL(20,4),       -- 筹资活动现金流(元)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT uk_stock_financial UNIQUE (symbol, report_date, report_type)
);

CREATE INDEX idx_stock_financial_symbol ON stock_financial_data(symbol);
CREATE INDEX idx_stock_financial_date ON stock_financial_data(report_date);
```

## 股票指标数据表 (stock_indicators)

```sql
CREATE TABLE stock_indicators (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL,              -- 股票代码
    calc_date DATE NOT NULL,                 -- 计算日期
    ma5 DECIMAL(12,4),                       -- 5日均线
    ma10 DECIMAL(12,4),                      -- 10日均线
    ma20 DECIMAL(12,4),                      -- 20日均线
    ma60 DECIMAL(12,4),                      -- 60日均线
    macd DECIMAL(12,4),                      -- MACD值
    dif DECIMAL(12,4),                       -- DIF值
    dea DECIMAL(12,4),                       -- DEA值
    k DECIMAL(12,4),                         -- KDJ-K值
    d DECIMAL(12,4),                         -- KDJ-D值
    j DECIMAL(12,4),                         -- KDJ-J值
    rsi6 DECIMAL(12,4),                      -- RSI6值
    rsi12 DECIMAL(12,4),                     -- RSI12值
    rsi24 DECIMAL(12,4),                     -- RSI24值
    boll_upper DECIMAL(12,4),                -- 布林线上轨
    boll_mid DECIMAL(12,4),                  -- 布林线中轨
    boll_lower DECIMAL(12,4),                -- 布林线下轨
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT uk_stock_indicators UNIQUE (symbol, calc_date)
);

CREATE INDEX idx_stock_indicators_symbol ON stock_indicators(symbol);
CREATE INDEX idx_stock_indicators_date ON stock_indicators(calc_date);
```

## 股票资金流向表 (stock_money_flow)

```sql
CREATE TABLE stock_money_flow (
    id SERIAL PRIMARY KEY,
    symbol VARCHAR(10) NOT NULL,              -- 股票代码
    trade_date DATE NOT NULL,                 -- 交易日期
    main_net DECIMAL(20,4),                  -- 主力净流入(元)
    retail_net DECIMAL(20,4),                -- 散户净流入(元)
    large_order_ratio DECIMAL(10,4),         -- 大单成交占比(%)
    medium_order_ratio DECIMAL(10,4),        -- 中单成交占比(%)
    small_order_ratio DECIMAL(10,4),         -- 小单成交占比(%)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT uk_stock_money_flow UNIQUE (symbol, trade_date)
);

CREATE INDEX idx_stock_money_flow_symbol ON stock_money_flow(symbol);
CREATE INDEX idx_stock_money_flow_date ON stock_money_flow(trade_date);
```

## 关系设计：

- 所有表通过symbol字段关联

- 使用复合唯一约束防止重复数据

## 数据类型选择：

- 价格类数据使用DECIMAL(12,4)保证精度

- 大额数据使用DECIMAL(20,4)避免溢出

- 日期字段统一使用DATE类型

## 索引优化：

- 为所有查询条件创建索引

- 主键使用自增序列

## 扩展性考虑：

- 预留created_at/updated_at字段

- 表结构支持多种数据频率(日/周/月)

## 与AKShare数据对应：

- 表字段设计与AKShare接口返回字段对应

- 保留原始数据的同时添加计算指标